---
import { Image } from 'astro:assets';

const { slides = [], title = 'MCP insight snapshots' } = Astro.props;
---

<div class="rounded-2xl border border-gray-800 bg-black/60 p-6" data-mcp-carousel>
  <div class="flex flex-wrap items-center justify-between gap-3">
    <h3 class="text-sm font-semibold uppercase tracking-[0.24em] text-brand-secondary/70">
      {title}
    </h3>
  </div>

  <div
    class="mt-6 relative overflow-hidden [mask-image:linear-gradient(to_right,transparent,black_10%,black_90%,transparent)]"
  >
    <div class="animate-marquee will-change-transform inline-flex w-max gap-6">
      {slides.map((slide, index) => (
        <div
          class="flex flex-col gap-3 rounded-2xl border border-gray-800 bg-black/80 p-4"
          aria-label={`${index + 1} of ${slides.length}`}
        >
          <button
            class="group relative overflow-hidden rounded-xl cursor-zoom-in focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-primary"
            type="button"
            data-modal-target={`mcp-carousel-modal-${index}`}
          >
            <Image
              src={slide.src}
              alt={slide.alt}
              class="h-56 w-auto rounded-xl object-cover transition-transform duration-300 group-hover:scale-[1.02]"
              loading={index === 0 ? 'eager' : 'lazy'}
            />
            <span class="pointer-events-none absolute inset-0 rounded-xl ring-1 ring-white/10" />
          </button>
          <p class="text-center text-xs font-semibold uppercase tracking-[0.24em] text-gray-400">
            {slide.label}
          </p>
          <dialog
            id={`mcp-carousel-modal-${index}`}
            class="mcp-carousel-modal rounded-2xl border-4 border-gray-800 bg-black/95 p-0 text-white"
            aria-label={slide.label}
          >
            <div class="flex items-start justify-between gap-4 border-b border-gray-800 px-5 py-4">
              <div class="text-sm font-semibold uppercase tracking-[0.2em] text-brand-secondary/70">
                {slide.label}
              </div>
              <button
                type="button"
                class="rounded-full border border-gray-700 px-3 py-1 text-xs font-semibold text-gray-200 transition hover:border-brand-primary hover:text-brand-primary"
                data-modal-close
              >
                Close
              </button>
            </div>
            <div class="p-6">
              <Image
                src={slide.src}
                alt={slide.alt}
                class="mcp-carousel-modal__image max-h-[80vh] w-auto max-w-[90vw] cursor-zoom-out rounded-xl object-contain"
                loading="lazy"
              />
            </div>
          </dialog>
        </div>
      ))}
      {slides.map((slide, index) => (
        <div
          class="flex flex-col gap-3 rounded-2xl border border-gray-800 bg-black/80 p-4"
          aria-label={`${index + 1} of ${slides.length}`}
          aria-hidden="true"
        >
          <button
            class="group relative overflow-hidden rounded-xl cursor-zoom-in focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-primary"
            type="button"
            data-modal-target={`mcp-carousel-modal-${index}`}
          >
            <Image
              src={slide.src}
              alt={slide.alt}
              class="h-56 w-auto rounded-xl object-cover transition-transform duration-300 group-hover:scale-[1.02]"
              loading="lazy"
            />
            <span class="pointer-events-none absolute inset-0 rounded-xl ring-1 ring-white/10" />
          </button>
          <p class="text-center text-xs font-semibold uppercase tracking-[0.24em] text-gray-400">
            {slide.label}
          </p>
        </div>
      ))}
    </div>
  </div>
</div>

<style>
  .mcp-carousel-modal::backdrop {
    background: rgba(2, 9, 12, 0.8);
  }

  .mcp-carousel-modal {
    max-width: 95vw;
    margin: auto;
    box-shadow: 0 0 40px rgba(0, 229, 255, 0.18);
  }
</style>

<script type="module">
  const carousel = document.querySelector('[data-mcp-carousel]');
  if (carousel) {
    const openButtons = carousel.querySelectorAll('[data-modal-target]');
    openButtons.forEach((button) => {
      const targetId = button.getAttribute('data-modal-target');
      const dialog = targetId ? document.getElementById(targetId) : null;
      if (!dialog) return;

      button.addEventListener('click', () => {
        if (typeof dialog.showModal === 'function') {
          dialog.showModal();
        }
      });

      dialog.addEventListener('click', (event) => {
        if (event.target === dialog) {
          dialog.close();
        }
      });

      const closeButton = dialog.querySelector('[data-modal-close]');
      if (closeButton) {
        closeButton.addEventListener('click', () => dialog.close());
      }

      const modalImage = dialog.querySelector('.mcp-carousel-modal__image');
      if (modalImage) {
        modalImage.addEventListener('click', () => dialog.close());
      }
    });
  }
</script>
